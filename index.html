<!DOCTYPE html>
<html lang="en">
<head>
  <!-- SECTION: meta -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="SLAdvisor.dev - Calculate and recommend the right SLA tier for your needs">
  <meta property="og:title" content="SLAdvisor.dev">
  <meta property="og:description" content="Interactive SLA recommendation tool for your services">
  <meta property="og:type" content="website">
  <meta property="og:image" content="https://sladvisor.dev/og-image.png">
  <meta property="og:url" content="https://sladvisor.dev">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="SLAdvisor.dev">
  <meta name="twitter:description" content="Interactive SLA recommendation tool for your services">
  <meta name="twitter:image" content="https://sladvisor.dev/og-image.png">
  <link rel="icon" href="/favicon.ico" sizes="48x32x16">
  <link rel="icon" href="/favicon.svg" type="image/svg+xml">
  <title>SLAdvisor.dev</title>

  <!-- SECTION: tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            mono: ['ui-monospace', 'SFMono-Regular', 'Menlo', 'Monaco', 'Consolas', 'Liberation Mono', 'Courier New', 'monospace'],
          }
        }
      }
    }
  </script>

  <!-- SECTION: dark-mode-init -->
  <script>
    (function() {
      var stored = localStorage.getItem('darkMode');
      var dark = stored !== null ? stored === 'true' : window.matchMedia('(prefers-color-scheme: dark)').matches;
      if (dark) document.documentElement.classList.add('dark');
    })();
  </script>

  <!-- SECTION: jspdf -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <!-- SECTION: styles -->
  <style>
    [x-cloak] { display: none !important; }
  </style>
</head>
<body class="min-h-screen bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-300">

  <!-- SECTION: app -->
  <div x-data="slaCalculator()" x-cloak>

    <!-- SECTION: header -->
    <header class="sticky top-0 z-50 bg-white/80 dark:bg-gray-900/80 backdrop-blur-sm border-b border-gray-200 dark:border-gray-700">
      <div class="max-w-4xl mx-auto px-4 py-4 flex items-center justify-between">
        <div class="flex items-center gap-3">
          <a @click.prevent="reset()" href="#" class="text-xl font-bold tracking-tight hover:opacity-80 transition-opacity"><span class="text-gray-400 dark:text-gray-500">SL</span><span class="text-blue-500">Advisor</span><span class="text-gray-400 dark:text-gray-500">.dev</span></a>
          <span class="hidden sm:inline text-sm text-gray-400 dark:text-gray-500 border-l border-gray-300 dark:border-gray-600 pl-3">What SLA does your service need?</span>
        </div>
        <div class="flex items-center gap-1">
        <a href="https://github.com/clementgineste/sladvisor" target="_blank" rel="noopener" aria-label="GitHub" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors">
          <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/></svg>
        </a>
        <button
          @click="toggleDarkMode()"
          class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-900"
          :aria-label="darkMode ? 'Switch to light mode' : 'Switch to dark mode'"
        >
          <svg x-show="!darkMode" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>
          </svg>
          <svg x-show="darkMode" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>
          </svg>
        </button>
        </div>
      </div>
    </header>

    <main class="max-w-4xl mx-auto px-4 py-8">

      <!-- SECTION: wizard -->
      <div x-show="!showResults">

        <!-- SECTION: progress -->
        <nav aria-label="Form progress" class="mb-8">
          <ol class="flex items-center justify-center gap-2">
            <template x-for="s in 6" :key="s">
              <li class="flex items-center">
                <div
                  class="w-8 h-8 rounded-full flex items-center justify-center text-sm font-semibold transition-colors duration-200"
                  :class="{
                    'bg-green-500 text-white': s < currentStep,
                    'bg-blue-500 text-white': s === currentStep,
                    'bg-gray-200 dark:bg-gray-700 text-gray-500 dark:text-gray-400': s > currentStep
                  }"
                  x-text="s"
                ></div>
                <div
                  x-show="s < 6"
                  class="w-6 sm:w-10 h-0.5 mx-1"
                  :class="s < currentStep ? 'bg-green-500' : 'bg-gray-200 dark:bg-gray-700'"
                ></div>
              </li>
            </template>
          </ol>
        </nav>

        <!-- SECTION: steps -->
        <div class="relative p-2 -m-2 min-h-[280px]" @keydown="handleCardKeydown">

          <!-- Step 1: Criticality -->
          <div
            x-show="currentStep === 1"
            class="absolute inset-0"
            x-transition:enter="transition ease-out duration-200"
            x-transition:enter-start="opacity-0"
            x-transition:enter-end="opacity-100"
            x-transition:leave="transition ease-in duration-100"
            x-transition:leave-start="opacity-100"
            x-transition:leave-end="opacity-0"
            role="tabpanel"
            aria-labelledby="step-1-heading"
          >
            <fieldset>
              <legend id="step-1-heading" class="text-2xl font-bold mb-2">Service criticality</legend>
              <p class="text-gray-600 dark:text-gray-400 mb-6">How critical is this service to your business?</p>
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <template x-for="opt in criticalityOptions" :key="opt.value">
                  <label
                    tabindex="0"
                    class="relative flex flex-col p-4 rounded-xl border-2 cursor-pointer transition-all duration-200 focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 dark:focus-visible:ring-offset-gray-900 focus:outline-none"
                    :class="criticality === opt.value
                      ? 'border-blue-500 bg-blue-50 dark:bg-blue-900/20 scale-[1.02]'
                      : 'border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 hover:border-gray-300 dark:hover:border-gray-600'"
                  >
                    <input
                      type="radio"
                      name="criticality"
                      :value="opt.value"
                      x-model="criticality"
                      class="sr-only" tabindex="-1"
                    >
                    <span x-show="criticality === opt.value" x-transition:enter="transition ease-out duration-150" x-transition:enter-start="opacity-0 scale-75" x-transition:enter-end="opacity-100 scale-100" x-transition:leave="transition ease-in duration-100" x-transition:leave-start="opacity-100 scale-100" x-transition:leave-end="opacity-0 scale-75" class="absolute top-2.5 right-2.5 w-5 h-5 bg-blue-500 rounded-full flex items-center justify-center"><svg class="w-3 h-3 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg></span>
                    <span class="font-semibold" x-text="opt.label"></span>
                    <span class="text-sm text-gray-500 dark:text-gray-400 mt-1" x-text="opt.desc"></span>
                  </label>
                </template>
              </div>
            </fieldset>
          </div>

          <!-- Step 2: Downtime Tolerance -->
          <div
            x-show="currentStep === 2"
            class="absolute inset-0"
            x-transition:enter="transition ease-out duration-200"
            x-transition:enter-start="opacity-0"
            x-transition:enter-end="opacity-100"
            x-transition:leave="transition ease-in duration-100"
            x-transition:leave-start="opacity-100"
            x-transition:leave-end="opacity-0"
            role="tabpanel"
            aria-labelledby="step-2-heading"
          >
            <fieldset>
              <legend id="step-2-heading" class="text-2xl font-bold mb-2">Downtime tolerance</legend>
              <p class="text-gray-600 dark:text-gray-400 mb-6">How much downtime is acceptable for your users?</p>
              <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                <template x-for="opt in downtimeToleranceOptions" :key="opt.value">
                  <label
                    tabindex="0"
                    class="relative flex flex-col p-4 rounded-xl border-2 cursor-pointer transition-all duration-200 focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 dark:focus-visible:ring-offset-gray-900 focus:outline-none"
                    :class="downtimeTolerance === opt.value
                      ? 'border-blue-500 bg-blue-50 dark:bg-blue-900/20 scale-[1.02]'
                      : 'border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 hover:border-gray-300 dark:hover:border-gray-600'"
                  >
                    <input
                      type="radio"
                      name="downtimeTolerance"
                      :value="opt.value"
                      x-model="downtimeTolerance"
                      class="sr-only" tabindex="-1"
                    >
                    <span x-show="downtimeTolerance === opt.value" x-transition:enter="transition ease-out duration-150" x-transition:enter-start="opacity-0 scale-75" x-transition:enter-end="opacity-100 scale-100" x-transition:leave="transition ease-in duration-100" x-transition:leave-start="opacity-100 scale-100" x-transition:leave-end="opacity-0 scale-75" class="absolute top-2.5 right-2.5 w-5 h-5 bg-blue-500 rounded-full flex items-center justify-center"><svg class="w-3 h-3 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg></span>
                    <span class="font-semibold" x-text="opt.label"></span>
                    <span class="text-sm text-gray-500 dark:text-gray-400 mt-1" x-text="opt.desc"></span>
                  </label>
                </template>
              </div>
            </fieldset>
          </div>

          <!-- Step 3: Support Window -->
          <div
            x-show="currentStep === 3"
            class="absolute inset-0"
            x-transition:enter="transition ease-out duration-200"
            x-transition:enter-start="opacity-0"
            x-transition:enter-end="opacity-100"
            x-transition:leave="transition ease-in duration-100"
            x-transition:leave-start="opacity-100"
            x-transition:leave-end="opacity-0"
            role="tabpanel"
            aria-labelledby="step-3-heading"
          >
            <fieldset>
              <legend id="step-3-heading" class="text-2xl font-bold mb-2">Support window</legend>
              <p class="text-gray-600 dark:text-gray-400 mb-6">What support coverage does this service require?</p>
              <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                <template x-for="opt in supportWindowOptions" :key="opt.value">
                  <label
                    tabindex="0"
                    class="relative flex flex-col p-4 rounded-xl border-2 cursor-pointer transition-all duration-200 focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 dark:focus-visible:ring-offset-gray-900 focus:outline-none"
                    :class="supportWindow === opt.value
                      ? 'border-blue-500 bg-blue-50 dark:bg-blue-900/20 scale-[1.02]'
                      : 'border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 hover:border-gray-300 dark:hover:border-gray-600'"
                  >
                    <input
                      type="radio"
                      name="supportWindow"
                      :value="opt.value"
                      x-model="supportWindow"
                      class="sr-only" tabindex="-1"
                    >
                    <span x-show="supportWindow === opt.value" x-transition:enter="transition ease-out duration-150" x-transition:enter-start="opacity-0 scale-75" x-transition:enter-end="opacity-100 scale-100" x-transition:leave="transition ease-in duration-100" x-transition:leave-start="opacity-100 scale-100" x-transition:leave-end="opacity-0 scale-75" class="absolute top-2.5 right-2.5 w-5 h-5 bg-blue-500 rounded-full flex items-center justify-center"><svg class="w-3 h-3 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg></span>
                    <span class="font-semibold" x-text="opt.label"></span>
                    <span class="text-sm text-gray-500 dark:text-gray-400 mt-1" x-text="opt.desc"></span>
                  </label>
                </template>
              </div>
            </fieldset>
          </div>

          <!-- Step 4: Budget -->
          <div
            x-show="currentStep === 4"
            class="absolute inset-0"
            x-transition:enter="transition ease-out duration-200"
            x-transition:enter-start="opacity-0"
            x-transition:enter-end="opacity-100"
            x-transition:leave="transition ease-in duration-100"
            x-transition:leave-start="opacity-100"
            x-transition:leave-end="opacity-0"
            role="tabpanel"
            aria-labelledby="step-4-heading"
          >
            <fieldset>
              <legend id="step-4-heading" class="text-2xl font-bold mb-2">Infrastructure budget</legend>
              <p class="text-gray-600 dark:text-gray-400 mb-6">What budget can you allocate to infrastructure and operations?</p>
              <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                <template x-for="opt in budgetOptions" :key="opt.value">
                  <label
                    tabindex="0"
                    class="relative flex flex-col p-4 rounded-xl border-2 cursor-pointer transition-all duration-200 focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 dark:focus-visible:ring-offset-gray-900 focus:outline-none"
                    :class="budgetLevel === opt.value
                      ? 'border-blue-500 bg-blue-50 dark:bg-blue-900/20 scale-[1.02]'
                      : 'border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 hover:border-gray-300 dark:hover:border-gray-600'"
                  >
                    <input
                      type="radio"
                      name="budgetLevel"
                      :value="opt.value"
                      x-model="budgetLevel"
                      class="sr-only" tabindex="-1"
                    >
                    <span x-show="budgetLevel === opt.value" x-transition:enter="transition ease-out duration-150" x-transition:enter-start="opacity-0 scale-75" x-transition:enter-end="opacity-100 scale-100" x-transition:leave="transition ease-in duration-100" x-transition:leave-start="opacity-100 scale-100" x-transition:leave-end="opacity-0 scale-75" class="absolute top-2.5 right-2.5 w-5 h-5 bg-blue-500 rounded-full flex items-center justify-center"><svg class="w-3 h-3 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg></span>
                    <span class="font-semibold" x-text="opt.label"></span>
                    <span class="text-sm text-gray-500 dark:text-gray-400 mt-1" x-text="opt.desc"></span>
                  </label>
                </template>
              </div>
            </fieldset>
          </div>

          <!-- Step 5: RTO -->
          <div
            x-show="currentStep === 5"
            class="absolute inset-0"
            x-transition:enter="transition ease-out duration-200"
            x-transition:enter-start="opacity-0"
            x-transition:enter-end="opacity-100"
            x-transition:leave="transition ease-in duration-100"
            x-transition:leave-start="opacity-100"
            x-transition:leave-end="opacity-0"
            role="tabpanel"
            aria-labelledby="step-5-heading"
          >
            <fieldset>
              <legend id="step-5-heading" class="text-2xl font-bold mb-2">RTO (Recovery Time Objective)</legend>
              <p class="text-gray-600 dark:text-gray-400 mb-6">How quickly must the service recover after an outage?</p>
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <template x-for="opt in rtoOptions" :key="opt.value">
                  <label
                    tabindex="0"
                    class="relative flex flex-col p-4 rounded-xl border-2 cursor-pointer transition-all duration-200 focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 dark:focus-visible:ring-offset-gray-900 focus:outline-none"
                    :class="rto === opt.value
                      ? 'border-blue-500 bg-blue-50 dark:bg-blue-900/20 scale-[1.02]'
                      : 'border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 hover:border-gray-300 dark:hover:border-gray-600'"
                  >
                    <input
                      type="radio"
                      name="rto"
                      :value="opt.value"
                      x-model="rto"
                      class="sr-only" tabindex="-1"
                    >
                    <span x-show="rto === opt.value" x-transition:enter="transition ease-out duration-150" x-transition:enter-start="opacity-0 scale-75" x-transition:enter-end="opacity-100 scale-100" x-transition:leave="transition ease-in duration-100" x-transition:leave-start="opacity-100 scale-100" x-transition:leave-end="opacity-0 scale-75" class="absolute top-2.5 right-2.5 w-5 h-5 bg-blue-500 rounded-full flex items-center justify-center"><svg class="w-3 h-3 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg></span>
                    <span class="font-semibold" x-text="opt.label"></span>
                    <span class="text-sm text-gray-500 dark:text-gray-400 mt-1" x-text="opt.desc"></span>
                  </label>
                </template>
              </div>
            </fieldset>
          </div>

          <!-- Step 6: RPO -->
          <div
            x-show="currentStep === 6"
            class="absolute inset-0"
            x-transition:enter="transition ease-out duration-200"
            x-transition:enter-start="opacity-0"
            x-transition:enter-end="opacity-100"
            x-transition:leave="transition ease-in duration-100"
            x-transition:leave-start="opacity-100"
            x-transition:leave-end="opacity-0"
            role="tabpanel"
            aria-labelledby="step-6-heading"
          >
            <fieldset>
              <legend id="step-6-heading" class="text-2xl font-bold mb-2">RPO (Recovery Point Objective)</legend>
              <p class="text-gray-600 dark:text-gray-400 mb-6">How much data loss can you tolerate?</p>
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <template x-for="opt in rpoOptions" :key="opt.value">
                  <label
                    tabindex="0"
                    class="relative flex flex-col p-4 rounded-xl border-2 cursor-pointer transition-all duration-200 focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 dark:focus-visible:ring-offset-gray-900 focus:outline-none"
                    :class="rpo === opt.value
                      ? 'border-blue-500 bg-blue-50 dark:bg-blue-900/20 scale-[1.02]'
                      : 'border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 hover:border-gray-300 dark:hover:border-gray-600'"
                  >
                    <input
                      type="radio"
                      name="rpo"
                      :value="opt.value"
                      x-model="rpo"
                      class="sr-only" tabindex="-1"
                    >
                    <span x-show="rpo === opt.value" x-transition:enter="transition ease-out duration-150" x-transition:enter-start="opacity-0 scale-75" x-transition:enter-end="opacity-100 scale-100" x-transition:leave="transition ease-in duration-100" x-transition:leave-start="opacity-100 scale-100" x-transition:leave-end="opacity-0 scale-75" class="absolute top-2.5 right-2.5 w-5 h-5 bg-blue-500 rounded-full flex items-center justify-center"><svg class="w-3 h-3 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/></svg></span>
                    <span class="font-semibold" x-text="opt.label"></span>
                    <span class="text-sm text-gray-500 dark:text-gray-400 mt-1" x-text="opt.desc"></span>
                  </label>
                </template>
              </div>
            </fieldset>
          </div>

        </div>

        <!-- SECTION: navigation -->
        <div class="flex justify-between mt-8">
          <button
            x-show="currentStep > 1"
            @click="prevStep()"
            class="px-6 py-2.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-900"
          >
            Previous
          </button>
          <div x-show="currentStep <= 1"></div>

          <button
            x-show="currentStep < 6"
            @click="nextStep()"
            :disabled="!isStepValid()"
            data-nav-next
            class="px-6 py-2.5 rounded-lg font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-900"
            :class="isStepValid()
              ? 'bg-blue-600 hover:bg-blue-700 text-white'
              : 'bg-gray-200 dark:bg-gray-700 text-gray-400 dark:text-gray-500 cursor-not-allowed'"
          >
            Next
          </button>

          <button
            x-show="currentStep === 6"
            @click="calculate()"
            :disabled="!isStepValid()"
            data-nav-next
            class="px-6 py-2.5 rounded-lg font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-900"
            :class="isStepValid()
              ? 'bg-green-600 hover:bg-green-700 text-white'
              : 'bg-gray-200 dark:bg-gray-700 text-gray-400 dark:text-gray-500 cursor-not-allowed'"
          >
            Calculate
          </button>
        </div>

      </div>

      <!-- SECTION: results -->
      <div
        x-show="showResults"
        x-transition:enter="transition ease-out duration-500"
        x-transition:enter-start="opacity-0 translate-y-4"
        x-transition:enter-end="opacity-100 translate-y-0"
        aria-live="polite"
      >

        <!-- Hero card -->
        <div
          class="rounded-2xl p-8 text-white mb-8"
          :class="result ? tierGradient(result.tier) : ''"
        >
          <p class="text-sm font-medium uppercase tracking-wider opacity-80">SLA recommendation</p>
          <h2 class="text-4xl font-bold mt-2" x-text="result ? result.tier : ''"></h2>
          <p class="text-5xl font-bold font-mono mt-2" x-text="result ? result.slaPercent + '%' : ''"></p>
          <p class="mt-3 opacity-80 text-sm">
            Score: <span class="font-mono font-semibold" x-text="result ? result.score + '/24' : ''"></span>
          </p>
        </div>

        <!-- Cards grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">

          <!-- Downtime card -->
          <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
            <h3 class="text-lg font-semibold mb-4">Allowed downtime</h3>
            <dl class="space-y-3">
              <div class="flex justify-between">
                <dt class="text-gray-500 dark:text-gray-400">Yearly</dt>
                <dd class="font-mono font-semibold" x-text="result ? result.downtimeYear : ''"></dd>
              </div>
              <div class="flex justify-between">
                <dt class="text-gray-500 dark:text-gray-400">Monthly</dt>
                <dd class="font-mono font-semibold" x-text="result ? result.downtimeMonth : ''"></dd>
              </div>
              <div class="flex justify-between">
                <dt class="text-gray-500 dark:text-gray-400">Weekly</dt>
                <dd class="font-mono font-semibold" x-text="result ? result.downtimeWeek : ''"></dd>
              </div>
            </dl>
          </div>

          <!-- Cost card -->
          <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
            <h3 class="text-lg font-semibold mb-4">Relative cost</h3>
            <dl class="space-y-3">
              <div class="flex justify-between">
                <dt class="text-gray-500 dark:text-gray-400">Multiplier</dt>
                <dd class="font-mono font-semibold text-lg" x-text="result ? result.costMultiplier : ''"></dd>
              </div>
            </dl>
            <p class="text-sm text-gray-500 dark:text-gray-400 mt-4">Compared to a baseline, non-redundant infrastructure.</p>
          </div>

          <!-- Architecture card -->
          <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
            <h3 class="text-lg font-semibold mb-4">Required architecture</h3>
            <ul class="space-y-2">
              <template x-for="item in (result ? result.architecture : [])" :key="item">
                <li class="flex items-start gap-2">
                  <svg class="w-5 h-5 text-green-500 shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/>
                  </svg>
                  <span x-text="item"></span>
                </li>
              </template>
            </ul>
          </div>

          <!-- Penalties card -->
          <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
            <h3 class="text-lg font-semibold mb-4">Penalties (service credits)</h3>
            <ul class="space-y-2">
              <template x-for="p in (result ? result.penalties : [])" :key="p">
                <li class="flex items-start gap-2">
                  <span class="text-amber-500 shrink-0 mt-0.5">&#9679;</span>
                  <span x-text="p"></span>
                </li>
              </template>
            </ul>
          </div>

        </div>

        <!-- Alerts -->
        <template x-if="result && result.warnings.length > 0">
          <div class="space-y-3 mb-8">
            <template x-for="w in result.warnings" :key="w.key">
              <div
                class="rounded-xl p-4 flex items-start gap-3 border"
                :class="{
                  'bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800': w.severity === 'error',
                  'bg-amber-50 dark:bg-amber-900/20 border-amber-200 dark:border-amber-800': w.severity === 'warning',
                  'bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800': w.severity === 'info'
                }"
              >
                <svg class="w-5 h-5 shrink-0 mt-0.5"
                  :class="{
                    'text-red-500': w.severity === 'error',
                    'text-amber-500': w.severity === 'warning',
                    'text-blue-500': w.severity === 'info'
                  }"
                  fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"
                >
                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                </svg>
                <div>
                  <p class="font-semibold text-sm"
                    :class="{
                      'text-red-800 dark:text-red-200': w.severity === 'error',
                      'text-amber-800 dark:text-amber-200': w.severity === 'warning',
                      'text-blue-800 dark:text-blue-200': w.severity === 'info'
                    }"
                    x-text="w.severity === 'error' ? 'Error' : w.severity === 'warning' ? 'Warning' : 'Info'"
                  ></p>
                  <p class="text-sm mt-1"
                    :class="{
                      'text-red-700 dark:text-red-300': w.severity === 'error',
                      'text-amber-700 dark:text-amber-300': w.severity === 'warning',
                      'text-blue-700 dark:text-blue-300': w.severity === 'info'
                    }"
                    x-text="w.message"
                  ></p>
                </div>
              </div>
            </template>
          </div>
        </template>

        <!-- Action buttons -->
        <div class="flex flex-wrap justify-center gap-3" data-no-print>
          <button
            @click="reset()"
            class="px-6 py-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-900"
          >
            Start over
          </button>
          <button
            @click="shareUrl()"
            class="px-6 py-3 rounded-lg bg-blue-500 hover:bg-blue-600 text-white font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-900"
            x-text="shared ? 'Link copied!' : 'Share'"
          >
          </button>
          <button
            @click="exportMarkdown()"
            class="px-6 py-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-900"
            x-text="exported ? 'Markdown copied!' : 'Copy Markdown'"
          >
          </button>
          <button
            @click="exportPDF()"
            :disabled="exporting"
            class="px-6 py-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-900 disabled:opacity-50"
            x-text="exporting ? 'Generating...' : 'Export PDF'"
          >
          </button>
        </div>

      </div>

      <!-- SECTION: reference (always visible) -->

      <!-- Comparison table -->
      <div class="mb-8 mt-12">
        <h3 class="text-lg font-semibold mb-4">Tier comparison</h3>
        <div class="overflow-x-auto">
          <table class="w-full text-sm border-collapse">
            <thead>
              <tr class="border-b border-gray-200 dark:border-gray-700">
                <th class="text-left py-3 px-3 font-semibold text-gray-500 dark:text-gray-400">Tier</th>
                <th class="text-right py-3 px-3 font-semibold text-gray-500 dark:text-gray-400">SLA</th>
                <th class="text-right py-3 px-3 font-semibold text-gray-500 dark:text-gray-400 hidden sm:table-cell">Downtime / year</th>
                <th class="text-right py-3 px-3 font-semibold text-gray-500 dark:text-gray-400 hidden sm:table-cell">Downtime / month</th>
                <th class="text-right py-3 px-3 font-semibold text-gray-500 dark:text-gray-400">Cost</th>
                <th class="text-left py-3 px-3 font-semibold text-gray-500 dark:text-gray-400 hidden md:table-cell">Use cases</th>
              </tr>
            </thead>
            <tbody>
              <template x-for="t in allTiers" :key="t.name">
                <tr
                  class="border-b border-gray-100 dark:border-gray-800 transition-colors"
                  :class="tierBadgeClass(t.name)"
                >
                  <td class="py-3 px-3">
                    <span class="inline-flex items-center gap-1.5">
                      <span class="font-semibold" x-text="t.name"></span>
                      <span x-show="result && result.tier === t.name" class="text-xs bg-blue-500 text-white px-1.5 py-0.5 rounded-full">recommended</span>
                    </span>
                  </td>
                  <td class="text-right py-3 px-3 font-mono" x-text="t.slaPercent + '%'"></td>
                  <td class="text-right py-3 px-3 font-mono hidden sm:table-cell" x-text="t.downtimeYear"></td>
                  <td class="text-right py-3 px-3 font-mono hidden sm:table-cell" x-text="t.downtimeMonth"></td>
                  <td class="text-right py-3 px-3 font-mono" x-text="t.costMultiplier"></td>
                  <td class="py-3 px-3 text-gray-500 dark:text-gray-400 hidden md:table-cell" x-text="t.useCases.join(', ')"></td>
                </tr>
              </template>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Cloud Provider SLAs -->
      <div class="mb-8">
        <h3 class="text-lg font-semibold mb-4">Cloud provider SLAs</h3>
        <div class="overflow-x-auto">
          <table class="w-full text-sm border-collapse">
            <thead>
              <tr class="border-b border-gray-200 dark:border-gray-700">
                <th class="text-left py-2.5 px-3 font-semibold text-gray-500 dark:text-gray-400">Service</th>
                <th class="text-center py-2.5 px-3 font-semibold text-gray-500 dark:text-gray-400">AWS</th>
                <th class="text-center py-2.5 px-3 font-semibold text-gray-500 dark:text-gray-400">GCP</th>
                <th class="text-center py-2.5 px-3 font-semibold text-gray-500 dark:text-gray-400">Azure</th>
              </tr>
            </thead>
            <tbody>
              <template x-for="sla in cloudSLAs" :key="sla.category">
                <tr class="border-b border-gray-100 dark:border-gray-800">
                  <td class="py-2.5 px-3 font-medium" x-text="sla.category"></td>
                  <td class="py-2.5 px-3 text-center">
                    <div class="text-xs text-gray-400 dark:text-gray-500" x-text="sla.aws.name"></div>
                    <div class="font-mono font-semibold" :class="result ? (sla.aws.sla < result.slaPercent ? 'text-amber-500' : 'text-green-600 dark:text-green-400') : ''" x-text="sla.aws.sla + '%'"></div>
                  </td>
                  <td class="py-2.5 px-3 text-center">
                    <div class="text-xs text-gray-400 dark:text-gray-500" x-text="sla.gcp.name"></div>
                    <div class="font-mono font-semibold" :class="result ? (sla.gcp.sla < result.slaPercent ? 'text-amber-500' : 'text-green-600 dark:text-green-400') : ''" x-text="sla.gcp.sla + '%'"></div>
                  </td>
                  <td class="py-2.5 px-3 text-center">
                    <div class="text-xs text-gray-400 dark:text-gray-500" x-text="sla.azure.name"></div>
                    <div class="font-mono font-semibold" :class="result ? (sla.azure.sla < result.slaPercent ? 'text-amber-500' : 'text-green-600 dark:text-green-400') : ''" x-text="sla.azure.sla + '%'"></div>
                  </td>
                </tr>
              </template>
            </tbody>
          </table>
        </div>

        <!-- Legend -->
        <p x-show="result" class="mt-3 text-xs text-gray-400 dark:text-gray-500">
          <span class="text-green-600 dark:text-green-400 font-semibold">&#9679;</span> Compatible with your target tier
          &nbsp;&middot;&nbsp;
          <span class="text-amber-500 font-semibold">&#9679;</span> Lower SLA than your target (needs attention)
        </p>

        <!-- Composite SLA formula -->
        <div class="mt-6 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700">
          <p class="font-semibold text-sm mb-1">Composite SLA formula</p>
          <p class="font-mono text-sm">SLA<sub>composite</sub> = SLA<sub>1</sub> &times; SLA<sub>2</sub> &times; &hellip; &times; SLA<sub>n</sub></p>
          <p class="text-sm text-gray-500 dark:text-gray-400 mt-2">Example: Compute (99.99%) &times; Database (99.95%) &times; Load Balancer (99.99%) = <span class="font-mono font-semibold text-gray-700 dark:text-gray-200">99.93%</span></p>
        </div>

        <!-- Sources -->
        <p class="mt-4 text-xs text-gray-400 dark:text-gray-500">
          Sources:
          <a href="https://aws.amazon.com/legal/service-level-agreements/" target="_blank" rel="noopener" class="underline hover:text-gray-600 dark:hover:text-gray-300">AWS SLA</a>,
          <a href="https://cloud.google.com/terms/sla" target="_blank" rel="noopener" class="underline hover:text-gray-600 dark:hover:text-gray-300">Google Cloud SLA</a>,
          <a href="https://www.microsoft.com/licensing/docs/view/Service-Level-Agreements-SLA-for-Online-Services" target="_blank" rel="noopener" class="underline hover:text-gray-600 dark:hover:text-gray-300">Azure SLA</a>
        </p>
      </div>

    </main>

    <!-- SECTION: footer -->
    <footer class="max-w-4xl mx-auto px-4 py-8 mt-8 border-t border-gray-200 dark:border-gray-700">
      <p class="text-center text-sm text-gray-500 dark:text-gray-400">
        SLAdvisor.dev &mdash; Built by <a href="https://github.com/clementgineste" class="text-gray-900 dark:text-white underline hover:text-blue-500 dark:hover:text-blue-400 transition-colors">Cl√©ment Gineste</a>
        &mdash; <a href="https://github.com/clementgineste/sladvisor/blob/main/SOURCES.md" class="underline hover:text-gray-700 dark:hover:text-gray-300">Sources & references</a>
      </p>
    </footer>

  </div>

  <!-- SECTION: engine -->
  <script>
    // Pure calculation engine - no side effects
    const SECONDS_PER_YEAR  = 31_536_000;
    const SECONDS_PER_MONTH = 2_592_000;
    const SECONDS_PER_WEEK  = 604_800;

    const TIERS = {
      Bronze: {
        slaPercent: 99.0,
        costMultiplier: '1x',
        architecture: [
          'Single instance (no redundancy)',
          'Basic monitoring (availability ping)',
          'Manual recovery procedures',
          'Single availability zone',
          'Periodic backups (daily)',
          'Shared infrastructure is acceptable',
        ],
        penalties: [
          '< 99.0%: 10% credit',
          '< 95.0%: 25% credit',
          '< 90.0%: 50% credit',
        ],
        useCases: ['Internal tools', 'Development environments', 'Prototypes'],
      },
      Silver: {
        slaPercent: 99.9,
        costMultiplier: '1.5-3x',
        architecture: [
          'Load balancer with health checks',
          'Automatic restart in case of failure',
          'Single-zone redundancy (2+ instances)',
          'Automated backups (hourly)',
          'Basic alerting (email / Slack)',
          'Incident response runbooks',
        ],
        penalties: [
          '< 99.9%: 10% credit',
          '< 99.0%: 25% credit',
          '< 95.0%: 50% credit',
        ],
        useCases: ['Standard business apps', 'B2B SaaS', 'Professional websites'],
      },
      Gold: {
        slaPercent: 99.95,
        costMultiplier: '3-5x',
        architecture: [
          'Multi-zone deployment (2+ availability zones)',
          'Auto-scaling groups',
          'Automatic failover (database, compute)',
          'Blue-green or canary deployments',
          'CDN for static assets',
          'Centralized monitoring (Datadog, Grafana)',
          'On-call with < 30 min response',
          'Backups with point-in-time restore',
        ],
        penalties: [
          '< 99.95%: 10% credit',
          '< 99.0%: 25% credit',
          '< 95.0%: 100% credit',
        ],
        useCases: ['Critical customer apps', 'E-commerce', 'SaaS platforms'],
      },
      Platinum: {
        slaPercent: 99.99,
        costMultiplier: '5-15x',
        architecture: [
          'Active-active multi-zone deployment',
          'Zero-downtime deployment pipeline',
          'Database replication with automatic failover (< 30s)',
          'Full observability (metrics, logs, traces, synthetic checks)',
          'Auto-scaling with predictive policies',
          'Dedicated incident response team (24/7)',
          'Chaos engineering (periodic fault injection)',
          'Immutable infrastructure (IaC)',
          'Service mesh for traffic management',
          'Automatic rollback on error-rate spikes',
        ],
        penalties: [
          '< 99.99%: 10% credit',
          '< 99.9%: 25% credit',
          '< 99.0%: 100% credit',
        ],
        useCases: ['Financial services', 'Healthcare', 'Critical infrastructure'],
      },
      Diamond: {
        slaPercent: 99.999,
        costMultiplier: '10-50x',
        architecture: [
          'Active-active multi-region deployment (3+ regions)',
          'Global load balancing with < 1s failover',
          'Cross-region synchronous data replication',
          'Continuous chaos engineering program',
          'RTO < 5 min, RPO ~ 0 (zero data loss)',
          'Automatic incident detection and remediation',
          'N+2 redundancy at every layer',
          'Dedicated SRE team (multiple engineers 24/7)',
          'Circuit breakers, bulkheads and retry budgets',
          'Continuous deployment with automated canary analysis',
          'Quarterly disaster recovery exercises',
        ],
        penalties: [
          '< 99.999%: 10% credit',
          '< 99.99%: 25% credit',
          '< 99.9%: 100% credit',
        ],
        useCases: ['Life safety', 'Real-time financial transactions', 'National critical infrastructure'],
      },
    };

    const SCORING = {
      criticality:       { low: 0, medium: 1, high: 3, critical: 4 },
      downtimeTolerance: { hours: 0, minutes: 2, seconds: 4 },
      supportWindow:     { business: 0, extended: 2, '24x7': 4 },
      budgetLevel:       { low: 0, medium: 2, high: 4 },
      rto:               { '4h': 0, '1h': 1, '15min': 3, '5min': 4 },
      rpo:               { '24h': 0, '1h': 1, '15min': 3, realtime: 4 },
    };

    const TIER_ORDER = ['Bronze', 'Silver', 'Gold', 'Platinum', 'Diamond'];

    const TIER_THRESHOLDS = [
      { minScore: 20, tier: 'Diamond' },
      { minScore: 15, tier: 'Platinum' },
      { minScore: 10, tier: 'Gold' },
      { minScore: 5,  tier: 'Silver' },
      { minScore: 0,  tier: 'Bronze' },
    ];

    const BUDGET_CAP = {
      low:    'Silver',
      medium: 'Platinum',
      high:   null, // no cap
    };

    const CLOUD_SLAS = [
      {
        category: 'Compute',
        aws:   { name: 'EC2',              sla: 99.99 },
        gcp:   { name: 'Compute Engine',   sla: 99.99 },
        azure: { name: 'Virtual Machines', sla: 99.99 },
      },
      {
        category: 'Database',
        aws:   { name: 'RDS Multi-AZ',  sla: 99.95 },
        gcp:   { name: 'Cloud SQL',     sla: 99.95 },
        azure: { name: 'SQL Database',  sla: 99.99 },
      },
      {
        category: 'Load Balancer',
        aws:   { name: 'ALB / NLB',            sla: 99.99 },
        gcp:   { name: 'Cloud Load Balancing',  sla: 99.99 },
        azure: { name: 'Load Balancer',         sla: 99.99 },
      },
      {
        category: 'Object storage',
        aws:   { name: 'S3',             sla: 99.9  },
        gcp:   { name: 'Cloud Storage',  sla: 99.95 },
        azure: { name: 'Blob Storage',   sla: 99.9  },
      },
      {
        category: 'Kubernetes',
        aws:   { name: 'EKS', sla: 99.95 },
        gcp:   { name: 'GKE', sla: 99.95 },
        azure: { name: 'AKS', sla: 99.95 },
      },
      {
        category: 'CDN',
        aws:   { name: 'CloudFront',  sla: 99.9  },
        gcp:   { name: 'Cloud CDN',   sla: 99.95 },
        azure: { name: 'Front Door',  sla: 99.99 },
      },
      {
        category: 'Serverless',
        aws:   { name: 'Lambda',           sla: 99.95 },
        gcp:   { name: 'Cloud Functions',  sla: 99.95 },
        azure: { name: 'Functions',        sla: 99.95 },
      },
    ];

    function formatDuration(seconds) {
      if (seconds < 1) return '< 1s';
      const days = Math.floor(seconds / 86400);
      seconds %= 86400;
      const hours = Math.floor(seconds / 3600);
      seconds %= 3600;
      const minutes = Math.floor(seconds / 60);
      const secs = Math.round(seconds % 60);

      const parts = [];
      if (days > 0) parts.push(days + 'd');
      if (hours > 0) parts.push(hours + 'h');
      if (minutes > 0) parts.push(minutes + 'min');
      if (secs > 0) parts.push(secs + 's');
      return parts.join(' ') || '< 1s';
    }

    function computeSLARecommendation(inputs) {
      // Calculate score
      const scores = {};
      let totalScore = 0;
      for (const key of Object.keys(SCORING)) {
        scores[key] = SCORING[key][inputs[key]] || 0;
        totalScore += scores[key];
      }

      // Map to tier
      let tier = 'Bronze';
      for (const t of TIER_THRESHOLDS) {
        if (totalScore >= t.minScore) {
          tier = t.tier;
          break;
        }
      }

      // Store uncapped tier for warning
      const uncappedTier = tier;

      // Apply budget cap
      const capTier = BUDGET_CAP[inputs.budgetLevel];
      if (capTier) {
        const capIndex = TIER_ORDER.indexOf(capTier);
        const tierIndex = TIER_ORDER.indexOf(tier);
        if (tierIndex > capIndex) {
          tier = capTier;
        }
      }

      // Get tier data
      const tierData = TIERS[tier];
      const slaFraction = 1 - (tierData.slaPercent / 100);

      // Calculate downtimes
      const downtimeYear  = formatDuration(SECONDS_PER_YEAR * slaFraction);
      const downtimeMonth = formatDuration(SECONDS_PER_MONTH * slaFraction);
      const downtimeWeek  = formatDuration(SECONDS_PER_WEEK * slaFraction);

      // Detect warnings
      const warnings = detectWarnings(inputs, tier, uncappedTier, totalScore);

      return {
        tier,
        slaPercent: tierData.slaPercent,
        downtimeYear,
        downtimeMonth,
        downtimeWeek,
        architecture: tierData.architecture,
        costMultiplier: tierData.costMultiplier,
        penalties: tierData.penalties,
        warnings,
        score: totalScore,
        scores,
        uncappedTier,
      };
    }

    function detectWarnings(inputs, tier, uncappedTier, totalScore) {
      const warnings = [];

      // 1. Budget cap active
      if (tier !== uncappedTier) {
        warnings.push({
          key: 'budget_cap',
          severity: 'warning',
          message: `Your technical needs indicate the ${uncappedTier} tier, but your budget caps the recommendation at ${tier}.`,
        });
      }

      // 2. High criticality + low budget
      if ((inputs.criticality === 'high' || inputs.criticality === 'critical') && inputs.budgetLevel === 'low') {
        warnings.push({
          key: 'critical_low_budget',
          severity: 'error',
          message: 'High criticality with a low budget is a major risk. Consider increasing budget or lowering availability expectations.',
        });
      }

      // 3. Critical + RTO 4h
      if (inputs.criticality === 'critical' && inputs.rto === '4h') {
        warnings.push({
          key: 'critical_slow_rto',
          severity: 'warning',
          message: 'An RTO of 4h is too high for a critical service. Target an RTO of 15 minutes or less.',
        });
      }

      // 4. Critical + RPO 24h
      if (inputs.criticality === 'critical' && inputs.rpo === '24h') {
        warnings.push({
          key: 'critical_high_rpo',
          severity: 'warning',
          message: 'An RPO of 24h means accepting one day of data loss for a critical service.',
        });
      }

      // 5. Tolerance seconds + relaxed RTO
      if (inputs.downtimeTolerance === 'seconds' && (inputs.rto === '4h' || inputs.rto === '1h')) {
        warnings.push({
          key: 'tolerance_rto_mismatch',
          severity: 'warning',
          message: `You only tolerate seconds of downtime but your RTO is ${inputs.rto}. These targets are inconsistent.`,
        });
      }

      // 6. 24/7 support + low budget
      if (inputs.supportWindow === '24x7' && inputs.budgetLevel === 'low') {
        warnings.push({
          key: 'support_budget_mismatch',
          severity: 'warning',
          message: '24/7 support requires an on-call team and is hard to sustain on a low budget.',
        });
      }

      // 7. Low criticality + high score (over-engineering)
      if (inputs.criticality === 'low' && totalScore >= 15) {
        warnings.push({
          key: 'overengineered',
          severity: 'info',
          message: 'These requirements are high for a low-criticality service. Ensure this investment level is justified.',
        });
      }

      // 8. Realtime RPO + low budget
      if (inputs.rpo === 'realtime' && inputs.budgetLevel === 'low') {
        warnings.push({
          key: 'realtime_rpo_low_budget',
          severity: 'error',
          message: 'A real-time RPO requires synchronous multi-region replication, which is incompatible with a low budget.',
        });
      }

      // 9. Diamond warning
      if (tier === 'Diamond') {
        warnings.push({
          key: 'diamond_complexity',
          severity: 'info',
          message: 'Diamond tier (99.999%) is extremely expensive and complex to operate. Confirm it is truly necessary.',
        });
      }

      // 10. Business hours support + tier >= Platinum
      const tierIndex = TIER_ORDER.indexOf(tier);
      if (inputs.supportWindow === 'business' && tierIndex >= 3) {
        warnings.push({
          key: 'support_tier_mismatch',
          severity: 'warning',
          message: 'Business-hours support is insufficient for this SLA level. Nights and weekends will consume your downtime budget.',
        });
      }

      return warnings;
    }
  </script>

  <!-- SECTION: alpine-data -->
  <script>
    function slaCalculator() {
      return {
        // Dark mode
        darkMode: document.documentElement.classList.contains('dark'),

        // Focus first card after step transition
        init() {
          // Sync dark mode with system preference changes
          window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
            localStorage.removeItem('darkMode');
            this.darkMode = e.matches;
            document.documentElement.classList.toggle('dark', e.matches);
          });
          // Load config from URL params
          const params = new URLSearchParams(window.location.search);
          const keys = ['criticality', 'downtimeTolerance', 'supportWindow', 'budgetLevel', 'rto', 'rpo'];
          const hasParams = keys.some(k => params.has(k));
          if (hasParams) {
            keys.forEach(k => { if (params.get(k)) this[k] = params.get(k); });
            this.$nextTick(() => this.calculate());
          }
          // Focus first card on page load
          if (!hasParams) {
            setTimeout(() => {
              const label = document.querySelector('#step-1-heading')?.closest('fieldset')?.querySelector('label[tabindex="0"]');
              if (label) label.focus();
            }, 100);
          }
          this.$watch('currentStep', (step) => {
            if (this.showResults) return;
            setTimeout(() => {
              const heading = document.getElementById('step-' + step + '-heading');
              if (heading) {
                const label = heading.closest('fieldset').querySelector('label[tabindex="0"]');
                if (label) label.focus();
              }
            }, 400);
          });
        },

        toggleDarkMode() {
          this.darkMode = !this.darkMode;
          document.documentElement.classList.toggle('dark', this.darkMode);
          localStorage.setItem('darkMode', this.darkMode);
        },

        // Wizard state
        currentStep: 1,
        showResults: false,
        result: null,
        shared: false,
        exported: false,
        exporting: false,

        // Inputs
        criticality: 'low',
        downtimeTolerance: 'hours',
        supportWindow: 'business',
        budgetLevel: 'low',
        rto: '4h',
        rpo: '24h',

        // Step options (data-driven)
        get criticalityOptions() {
          return [
            { value: 'low', label: 'Low', desc: 'Internal tools, dev environments' },
            { value: 'medium', label: 'Medium', desc: 'Non-critical business applications' },
            { value: 'high', label: 'High', desc: 'Customer-facing apps, e-commerce' },
            { value: 'critical', label: 'Critical', desc: 'Financial, healthcare, safety services' },
          ];
        },

        get downtimeToleranceOptions() {
          return [
            { value: 'hours', label: 'Hours', desc: 'A few hours of downtime are acceptable' },
            { value: 'minutes', label: 'Minutes', desc: 'Downtime should stay under a few minutes' },
            { value: 'seconds', label: 'Seconds', desc: 'Every second of downtime has impact' },
          ];
        },

        get supportWindowOptions() {
          return [
            { value: 'business', label: 'Business hours', desc: 'Mon-Fri, 9am-6pm' },
            { value: 'extended', label: 'Extended', desc: 'Mon-Sat, 7am-10pm' },
            { value: '24x7', label: '24/7', desc: 'Continuous support, including nights and weekends' },
          ];
        },

        get budgetOptions() {
          return [
            { value: 'low', label: 'Low', desc: 'Limited budget, minimal infrastructure' },
            { value: 'medium', label: 'Medium', desc: 'Reasonable budget for redundancy' },
            { value: 'high', label: 'High', desc: 'Substantial budget for high availability' },
          ];
        },

        get rtoOptions() {
          return [
            { value: '4h', label: '4 hours', desc: 'Half-day recovery is acceptable' },
            { value: '1h', label: '1 hour', desc: 'Fast recovery is required' },
            { value: '15min', label: '15 minutes', desc: 'Automatic failover is required' },
            { value: '5min', label: '5 minutes', desc: 'Near-instant recovery' },
          ];
        },

        get rpoOptions() {
          return [
            { value: '24h', label: '24 hours', desc: 'One day of data loss is acceptable' },
            { value: '1h', label: '1 hour', desc: 'Frequent backups are required' },
            { value: '15min', label: '15 minutes', desc: 'Asynchronous replication is required' },
            { value: 'realtime', label: 'Real-time', desc: 'Zero data loss (synchronous replication)' },
          ];
        },

        // Step validation
        isStepValid() {
          switch (this.currentStep) {
            case 1: return this.criticality !== null;
            case 2: return this.downtimeTolerance !== null;
            case 3: return this.supportWindow !== null;
            case 4: return this.budgetLevel !== null;
            case 5: return this.rto !== null;
            case 6: return this.rpo !== null;
            default: return false;
          }
        },

        // Keyboard navigation for cards (single handler on steps container)
        handleCardKeydown(e) {
          const label = e.target.closest('label[tabindex="0"]');
          if (!label) return;
          if (e.key === 'Enter') {
            e.preventDefault();
            label.querySelector('input').click();
            this.$nextTick(() => { if (this.currentStep === 6) { this.calculate(); } else { const btn = document.querySelector('[data-nav-next]'); if (btn) btn.focus(); } });
          } else if (e.key === ' ') {
            e.preventDefault();
            label.querySelector('input').click();
          } else if (e.key === 'ArrowDown' || e.key === 'ArrowRight') {
            e.preventDefault();
            this.navigateCard(label, 1);
          } else if (e.key === 'ArrowUp' || e.key === 'ArrowLeft') {
            e.preventDefault();
            this.navigateCard(label, -1);
          }
        },

        navigateCard(current, direction) {
          const sibling = direction > 0 ? current.nextElementSibling : current.previousElementSibling;
          if (sibling && sibling.tagName === 'LABEL') {
            const input = sibling.querySelector('input');
            sibling.focus();
            this[input.name] = input.value;
          }
        },

        // Navigation
        nextStep() {
          if (this.isStepValid() && this.currentStep < 6) {
            this.currentStep++;
          }
        },

        prevStep() {
          if (this.currentStep > 1) {
            this.currentStep--;
          }
        },

        // Calculate
        calculate() {
          if (!this.isStepValid()) return;
          this.result = computeSLARecommendation({
            criticality: this.criticality,
            downtimeTolerance: this.downtimeTolerance,
            supportWindow: this.supportWindow,
            budgetLevel: this.budgetLevel,
            rto: this.rto,
            rpo: this.rpo,
          });
          this.showResults = true;
          const params = new URLSearchParams({ criticality: this.criticality, downtimeTolerance: this.downtimeTolerance, supportWindow: this.supportWindow, budgetLevel: this.budgetLevel, rto: this.rto, rpo: this.rpo });
          history.replaceState(null, '', '?' + params.toString());
        },

        shareUrl() {
          navigator.clipboard.writeText(window.location.href);
          this.shared = true;
          setTimeout(() => this.shared = false, 2000);
        },

        async exportPDF() {
          const r = this.result;
          if (!r || this.exporting) return;
          this.exporting = true;
          await new Promise(resolve => setTimeout(resolve, 50));
          const { jsPDF } = window.jspdf;
          const doc = new jsPDF({ unit: 'mm', format: 'a4' });
          const W = 210, M = 20, CW = W - 2 * M;
          let y = M;

          const tierColors = {
            Bronze: [217, 119, 6], Silver: [107, 114, 128], Gold: [234, 179, 8],
            Platinum: [79, 70, 229], Diamond: [8, 145, 178],
          };
          const color = tierColors[r.tier] || [59, 130, 246];

          // Input labels lookup
          const inputLabels = {
            criticality: Object.fromEntries(this.criticalityOptions.map(o => [o.value, o.label])),
            downtimeTolerance: Object.fromEntries(this.downtimeToleranceOptions.map(o => [o.value, o.label])),
            supportWindow: Object.fromEntries(this.supportWindowOptions.map(o => [o.value, o.label])),
            budgetLevel: Object.fromEntries(this.budgetOptions.map(o => [o.value, o.label])),
            rto: Object.fromEntries(this.rtoOptions.map(o => [o.value, o.label])),
            rpo: Object.fromEntries(this.rpoOptions.map(o => [o.value, o.label])),
          };

          // Header band
          doc.setFillColor(...color);
          doc.rect(0, 0, W, 45, 'F');
          doc.setTextColor(255, 255, 255);
          doc.setFontSize(28);
          doc.setFont('helvetica', 'bold');
          doc.textWithLink('SLAdvisor.dev', M, 18, { url: 'https://sladvisor.dev' });
          doc.setFontSize(14);
          doc.setFont('helvetica', 'normal');
          doc.text('SLA recommendation', M, 27);
          doc.setFontSize(36);
          doc.setFont('helvetica', 'bold');
          doc.text(r.tier + '  ‚Äî  ' + r.slaPercent + '%', M, 40);
          // Badge pills (top right)
          const badges = [
            { label: 'Sources', url: 'https://github.com/clementgineste/sladvisor/blob/main/SOURCES.md', icon: 'doc' },
            { label: 'GitHub', url: 'https://github.com/clementgineste/sladvisor', icon: 'github' },
          ];
          let bx = W - M;
          doc.setFontSize(8);
          doc.setFont('helvetica', 'bold');
          badges.forEach(b => {
            const tw = doc.getTextWidth(b.label) + 13;
            const bxStart = bx - tw;
            const by = 9, bh = 8;
            // Pill (clickable area)
            doc.setFillColor(255, 255, 255);
            doc.setGState(new doc.GState({ opacity: 0.2 }));
            doc.roundedRect(bxStart, by, tw, bh, 4, 4, 'F');
            doc.setGState(new doc.GState({ opacity: 1 }));
            doc.link(bxStart, by, tw, bh, { url: b.url });
            // Icon
            doc.setDrawColor(255, 255, 255);
            doc.setFillColor(255, 255, 255);
            const ix = bxStart + 5, iy = by + bh / 2;
            if (b.icon === 'github') {
              doc.circle(ix, iy, 2.2, 'F');
              doc.setFillColor(...color);
              doc.circle(ix, iy - 0.2, 1.3, 'F');
              doc.setFillColor(255, 255, 255);
              doc.circle(ix - 0.5, iy - 0.5, 0.4, 'F');
              doc.circle(ix + 0.5, iy - 0.5, 0.4, 'F');
            } else {
              doc.setLineWidth(0.3);
              doc.rect(ix - 1.5, iy - 2, 3, 4);
              doc.line(ix - 0.8, iy - 0.5, ix + 0.8, iy - 0.5);
              doc.line(ix - 0.8, iy + 0.5, ix + 0.8, iy + 0.5);
            }
            // Label
            doc.setTextColor(255, 255, 255);
            doc.text(b.label, bxStart + 9, by + bh / 2 + 1);
            bx = bxStart - 3;
          });
          y = 55;

          // Context bar
          doc.setFontSize(9);
          doc.setFont('helvetica', 'normal');
          doc.setTextColor(100, 100, 100);
          doc.text('Score: ' + r.score + '/24  |  ' + new Date().toLocaleDateString('en-US'), M, y);
          y += 6;
          doc.setFontSize(8);
          doc.setTextColor(130, 130, 130);
          doc.text('An SLA (Service Level Agreement) defines the guaranteed availability level between provider and customer.', M, y);
          y += 4;
          doc.text('This document summarizes the technical, financial, and operational implications of the recommended tier.', M, y);
          y += 8;
          // Tier scale bar
          const tiers = ['Bronze', 'Silver', 'Gold', 'Platinum', 'Diamond'];
          const segW = CW / tiers.length;
          const allColors = {
            Bronze: [217, 119, 6], Silver: [160, 165, 170], Gold: [234, 179, 8],
            Platinum: [79, 70, 229], Diamond: [8, 145, 178],
          };
          tiers.forEach((t, i) => {
            const sx = M + i * segW;
            const c = allColors[t];
            const isActive = t === r.tier;
            doc.setFillColor(...c);
            doc.setGState(new doc.GState({ opacity: isActive ? 1 : 0.2 }));
            doc.roundedRect(sx + 0.5, y, segW - 1, 5, 1, 1, 'F');
            doc.setGState(new doc.GState({ opacity: 1 }));
            doc.setFontSize(7);
            doc.setFont('helvetica', isActive ? 'bold' : 'normal');
            doc.setTextColor(isActive ? 255 : 120, isActive ? 255 : 120, isActive ? 255 : 120);
            doc.text(t, sx + segW / 2, y + 3.5, { align: 'center' });
          });
          y += 10;

          // Section helper
          const section = (title) => {
            doc.setFillColor(...color);
            doc.rect(M, y, 2, 7, 'F');
            doc.setTextColor(40, 40, 40);
            doc.setFontSize(12);
            doc.setFont('helvetica', 'bold');
            doc.text(title, M + 5, y + 5.5);
            y += 12;
          };

          // User inputs
          section('Selected inputs');
          doc.setFontSize(9);
          doc.setFont('helvetica', 'normal');
          doc.setTextColor(60, 60, 60);
          const inputs = [
            ['Criticality', inputLabels.criticality[this.criticality]],
            ['Downtime tolerance', inputLabels.downtimeTolerance[this.downtimeTolerance]],
            ['Support', inputLabels.supportWindow[this.supportWindow]],
            ['Budget', inputLabels.budgetLevel[this.budgetLevel]],
            ['RTO', inputLabels.rto[this.rto]],
            ['RPO', inputLabels.rpo[this.rpo]],
          ];
          const col1 = M + 5, col2 = M + CW / 2 + 5;
          for (let i = 0; i < inputs.length; i += 2) {
            doc.setFont('helvetica', 'normal');
            doc.setTextColor(120, 120, 120);
            doc.text(inputs[i][0], col1, y);
            doc.setFont('helvetica', 'bold');
            doc.setTextColor(40, 40, 40);
            doc.text(inputs[i][1], col1 + 30, y);
            if (inputs[i + 1]) {
              doc.setFont('helvetica', 'normal');
              doc.setTextColor(120, 120, 120);
              doc.text(inputs[i + 1][0], col2, y);
              doc.setFont('helvetica', 'bold');
              doc.setTextColor(40, 40, 40);
              doc.text(inputs[i + 1][1], col2 + 30, y);
            }
            y += 6;
          }
          y += 6;

          // Downtime
          section('Allowed downtime');
          doc.setFontSize(10);
          doc.setFont('helvetica', 'normal');
          doc.setTextColor(60, 60, 60);
          [['Yearly', r.downtimeYear], ['Monthly', r.downtimeMonth], ['Weekly', r.downtimeWeek]].forEach(([label, val]) => {
            doc.text(label, M + 5, y);
            doc.setFont('helvetica', 'bold');
            doc.text(val, M + CW, y, { align: 'right' });
            doc.setFont('helvetica', 'normal');
            y += 6;
          });
          y += 6;

          // Cost
          section('Relative cost');
          doc.setFontSize(10);
          doc.text('Multiplier vs baseline infrastructure:', M + 5, y);
          doc.setFont('helvetica', 'bold');
          doc.text(r.costMultiplier, M + CW, y, { align: 'right' });
          doc.setFont('helvetica', 'normal');
          y += 10;

          // Architecture
          section('Required architecture');
          doc.setFontSize(9);
          r.architecture.forEach(item => {
            doc.setFillColor(...color);
            doc.circle(M + 7, y - 1, 1, 'F');
            doc.setTextColor(60, 60, 60);
            doc.text(item, M + 11, y);
            y += 5;
          });
          y += 5;

          // Penalties
          section('Penalties (service credits)');
          doc.setFontSize(9);
          r.penalties.forEach(p => {
            doc.text('‚Ä¢  ' + p, M + 5, y);
            y += 5;
          });
          y += 5;

          // Warnings
          if (r.warnings.length > 0) {
            section('Warnings');
            doc.setFontSize(9);
            r.warnings.forEach(w => {
              const prefix = w.severity === 'error' ? '[ERROR]' : w.severity === 'warning' ? '[WARNING]' : '[INFO]';
              doc.setFont('helvetica', 'bold');
              doc.setTextColor(w.severity === 'error' ? 220 : 180, w.severity === 'error' ? 50 : 120, 0);
              doc.text(prefix, M + 5, y);
              const pw = doc.getTextWidth(prefix);
              doc.setFont('helvetica', 'normal');
              doc.setTextColor(60, 60, 60);
              doc.text(w.message, M + 7 + pw, y, { maxWidth: CW - pw - 12 });
              y += 7;
            });
          }

          // Footer
          doc.setFontSize(8);
          doc.setTextColor(150, 150, 150);
          doc.setFont('helvetica', 'normal');
          const f1 = 'sladvisor.dev';
          const sep = ' ‚Äî ';
          const f2 = 'Built by Cl√©ment Gineste';
          const totalW = doc.getTextWidth(f1 + sep + f2);
          const fx = (W - totalW) / 2;
          doc.textWithLink(f1, fx, 287, { url: 'https://sladvisor.dev' });
          doc.text(sep, fx + doc.getTextWidth(f1), 287);
          doc.textWithLink(f2, fx + doc.getTextWidth(f1 + sep), 287, { url: 'https://github.com/clementgineste' });

          doc.save('sladvisor-' + r.tier.toLowerCase() + '.pdf');
          await new Promise(resolve => setTimeout(resolve, 600));
          this.exporting = false;
        },

        exportMarkdown() {
          const r = this.result;
          if (!r) return;
          const lines = [
            '# SLA Recommendation ‚Äî ' + r.tier + ' (' + r.slaPercent + '%)',
            '',
            '> Generated by [SLAdvisor.dev](' + window.location.href + ')',
            '',
            '## Allowed downtime',
            '',
            '| Period | Duration |',
            '|---|---|',
            '| Yearly | ' + r.downtimeYear + ' |',
            '| Monthly | ' + r.downtimeMonth + ' |',
            '| Weekly | ' + r.downtimeWeek + ' |',
            '',
            '## Relative cost',
            '',
            'Multiplier: **' + r.costMultiplier + '** (vs baseline infrastructure)',
            '',
            '## Required architecture',
            '',
            ...r.architecture.map(a => '- ' + a),
            '',
            '## Penalties',
            '',
            ...r.penalties.map(p => '- ' + p),
          ];
          if (r.warnings.length > 0) {
            lines.push('', '## Warnings', '');
            r.warnings.forEach(w => lines.push('- **' + w.severity + '**: ' + w.message));
          }
          lines.push('', '---', 'Score: ' + r.score + '/24');
          navigator.clipboard.writeText(lines.join('\n'));
          this.exported = true;
          setTimeout(() => this.exported = false, 2000);
        },

        // Reset
        reset() {
          this.currentStep = 1;
          this.showResults = false;
          this.result = null;
          this.shared = false;
          history.replaceState(null, '', window.location.pathname);
          this.criticality = 'low';
          this.downtimeTolerance = 'hours';
          this.supportWindow = 'business';
          this.budgetLevel = 'low';
          this.rto = '4h';
          this.rpo = '24h';
        },

        // All tiers for comparison table
        get allTiers() {
          return ['Bronze', 'Silver', 'Gold', 'Platinum', 'Diamond'].map(name => {
            const t = TIERS[name];
            const frac = 1 - (t.slaPercent / 100);
            return {
              name,
              slaPercent: t.slaPercent,
              downtimeYear: formatDuration(SECONDS_PER_YEAR * frac),
              downtimeMonth: formatDuration(SECONDS_PER_MONTH * frac),
              costMultiplier: t.costMultiplier,
              useCases: t.useCases,
            };
          });
        },

        get cloudSLAs() { return CLOUD_SLAS; },

        // Tier gradient mapping
        tierGradient(tier) {
          const gradients = {
            Bronze:   'bg-gradient-to-r from-amber-600 to-amber-500',
            Silver:   'bg-gradient-to-r from-gray-500 to-gray-400',
            Gold:     'bg-gradient-to-r from-yellow-500 to-yellow-400',
            Platinum: 'bg-gradient-to-r from-indigo-600 to-indigo-500',
            Diamond:  'bg-gradient-to-r from-cyan-600 to-cyan-400',
          };
          return gradients[tier] || '';
        },

        tierBadgeClass(tier) {
          const styles = {
            Bronze:   'bg-amber-100 text-amber-800 dark:bg-amber-900/40 dark:text-amber-300',
            Silver:   'bg-gray-100 text-gray-700 dark:bg-gray-700/40 dark:text-gray-300',
            Gold:     'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/40 dark:text-yellow-300',
            Platinum: 'bg-indigo-100 text-indigo-800 dark:bg-indigo-900/40 dark:text-indigo-300',
            Diamond:  'bg-cyan-100 text-cyan-800 dark:bg-cyan-900/40 dark:text-cyan-300',
          };
          return styles[tier] || '';
        },

        tierBorderClass(tier) {
          const styles = {
            Bronze:   'border-l-amber-500',
            Silver:   'border-l-gray-400',
            Gold:     'border-l-yellow-500',
            Platinum: 'border-l-indigo-500',
            Diamond:  'border-l-cyan-500',
          };
          return styles[tier] || '';
        },
      };
    }
  </script>

  <!-- SECTION: alpinejs -->
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

</body>
</html>
